# Cracking Basic Hashes: John the Ripper

## Cracking Windows Authentication Hashes 

**Crack NTHash / NTLM**  

```bash
$ ./john --format=nt --wordlist=/usr/share/wordlists/rockyou.txt ~/Downloads/ntlm.txt
Using default input encoding: UTF-8
Loaded 1 password hash (NT [MD4 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=4
Press 'q' or Ctrl-C to abort, almost any other key for status
mushroom         (?)     
1g 0:00:00:00 DONE (2021-01-21 22:15) 100.0g/s 307200p/s 307200c/s 307200C/s skater1..dangerous
Use the "--show --format=NT" options to display all of the cracked passwords reliably
Session completed. 
```

## Cracking /etc/shadow Hashes

**Unshadowing**

John can be very particular about the formats it needs data in to be able to work with it, for this reason- in order to crack /etc/shadow passwords, you must combine it with the /etc/passwd file in order for John to understand the data it's being given. To do this, we use a tool built into the John suite of tools called unshadow. The basic syntax of unshadow is as follows:

```bash
$ cat localshadow 
root:$6$Ha.d5nGupBm29pYr$yugXSk24ZljLTAZZagtGwpSQhb3F2DOJtnHrvk7HI2ma4GsuioHp8sm3LJiRJpKfIf7lZQ29qgtH17Q/JDpYM/:18576::::::

$ cat localpasswd 
root:x:0:0::/root:/bin/bash

$ unshadow localpasswd localshadow > unshadow

$ cat unshadow 
root:$6$Ha.d5nGupBm29pYr$yugXSk24ZljLTAZZagtGwpSQhb3F2DOJtnHrvk7HI2ma4GsuioHp8sm3LJiRJpKfIf7lZQ29qgtH17Q/JDpYM/:0:0::/root:/bin/bash
```

**Cracking**

We're then able to feed the output from unshadow, in our example use case called "unshadowed.txt" directly into John. We should not need to specify a mode here as we have made the input specifically for John, however in some cases you will need to specify the format as we have done previously using: --format=sha512crypt

```bash
$ /usr/local/bin/john-jumbo/run/john --wordlist=/usr/share/wordlists/rockyou.txt --format=sha512crypt ~/Downloads/unshadow 
Using default input encoding: UTF-8
Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
1234             (root)     
1g 0:00:00:00 DONE (2021-01-21 22:25) 1.785g/s 2742p/s 2742c/s 2742C/s kucing..mexico1
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

## Single Crack Mode

In this mode, John uses only the information provided in the username, to try and work out possible passwords heuristically, by slightly changing the letters and numbers contained within the username.

If we take the username: Markus

Some possible passwords could be:

    Markus1, Markus2, Markus3 (etc.)
    MArkus, MARkus, MARKus (etc.)

**A Note on File Formats in Single Crack Mode:**

If you're cracking hashes in single crack mode, you need to change the file format that you're feeding john for it to understand what data to create a wordlist from.

From:

1efee03cdcb96d90ad48ccc7b8666033

To

mike:1efee03cdcb96d90ad48ccc7b8666033

```bash
$ cat hash7.txt 
joker:7bf6d9bb82bed1302f331fc6b816aada

$ /usr/local/bin/john-jumbo/run/john --single --format=raw-md5 ~/Downloads/hash7.txt
Using default input encoding: UTF-8
Loaded 1 password hash (Raw-MD5 [MD5 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=4
Press 'q' or Ctrl-C to abort, almost any other key for status
Warning: Only 2 candidates buffered for the current salt, minimum 24 needed for performance.
Warning: Only 20 candidates buffered for the current salt, minimum 24 needed for performance.
Jok3r            (joker)     
1g 0:00:00:00 DONE (2021-01-21 22:33) 100.0g/s 19500p/s 19500c/s 19500C/s j0ker..J0k3r
Use the "--show --format=Raw-MD5" options to display all of the cracked passwords reliably
Session completed. 
```

## Custom Rules 

Custom rules are located in `/etc/john/john.conf` 
[there is a massive level of granular control that you can define in these rules](https://www.openwall.com/john/doc/RULES.shtml)


## Cracking Password Protected Zip Files 

Convert the zip file into a hash format that John is able to understand

```bash
$ zip2john secure.zip > secure_hash
Created directory: /home/clobee/.john
ver 1.0 efh 5455 efh 7875 secure.zip/zippy/flag.txt PKZIP Encr: 2b chk, TS_chk, cmplen=38, decmplen=26, crc=849AB5A6
```

Now let's feeed the hash file to John

```bash
$ john --wordlist=/usr/share/wordlists/rockyou.txt secure_hash 
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
pass123          (secure.zip/zippy/flag.txt)
1g 0:00:00:00 DONE (2021-01-24 20:05) 100.0g/s 819200p/s 819200c/s 819200C/s 123456..whitetiger
Use the "--show" option to display all of the cracked passwords reliably
Session completed
```

## Cracking Password Protected RAR Archives

Convert the rar file into a hash format that John is able to understand

```bash
$ rar2john secure.rar > rar_hash
```

Now let's feeed the hash file to John

```bash
$ john --wordlist=/usr/share/wordlists/rockyou.txt rar_hash   
Using default input encoding: UTF-8
Loaded 1 password hash (RAR5 [PBKDF2-SHA256 256/256 AVX2 8x])
Cost 1 (iteration count) is 32768 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
password         (secure.rar)
1g 0:00:00:00 DONE (2021-01-24 20:16) 4.166g/s 533.3p/s 533.3c/s 533.3C/s 123456..diamond
Use the "--show" option to display all of the cracked passwords reliably
Session completed
```

```bash
$ unrar e secure.rar

UNRAR 5.91 freeware      Copyright (c) 1993-2020 Alexander Roshal

Enter password (will not be echoed) for secure.rar: 


Extracting from secure.rar

Extracting  flag.txt                                                  OK 
All OK
```

## Cracking SSH Key Passwords 

Using John to crack the SSH private key password of id_rsa files. 

```bash
$ locate ssh2john               
/home/clobee/tmp/ccpentesting/john/run/ssh2john.py
/usr/local/bin/john-jumbo/run/ssh2john.py
/usr/share/john/ssh2john.py
```
```bash
$ /usr/share/john/ssh2john.py idrsa.id_rsa > idrsa.hash
```

```bash
$ john --wordlist=/usr/share/wordlists/rockyou.txt idrsa.hash 
Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 4 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
mango            (idrsa.id_rsa)
Warning: Only 3 candidates left, minimum 4 needed for performance.
1g 0:00:00:04 DONE (2021-01-24 20:39) 0.2150g/s 3084Kp/s 3084Kc/s 3084KC/sabygurl69..*7¡Vamos!
Session completed
```

## Cracking encrypted gpg files


### How to encrypt

```bash
$ cat secret.txt 
this is secret

$ gpg --cipher-algo AES-256 --symmetric secret.txt

$ cat secret.txt.gpg 
����*wj\k��M�MQ��fym�r��O�S�<}�W�0%     
```

### How to decrypt

```bash
$ gpg secret.txt.gpg 
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: AES256 encrypted data
gpg: encrypted with 1 passphrase
File 'secret.txt' exists. Overwrite? (y/N) y

$ cat secret.txt
this is secret
```

### Descrypt using john

```bash
$ gpg2john secret.txt.gpg > hash                                    

File secret.txt.gpg

$ john --wordlist=/usr/share/wordlists/rockyou.txt --format=gpg hash
Using default input encoding: UTF-8
Loaded 1 password hash (gpg, OpenPGP / GnuPG Secret Key [32/64])
Cost 1 (s2k-count) is 65011712 for all loaded hashes
Cost 2 (hash algorithm [1:MD5 2:SHA1 3:RIPEMD160 8:SHA256 9:SHA384 10:SHA512 11:SHA224]) is 2 for all loaded hashes
Cost 3 (cipher algorithm [1:IDEA 2:3DES 3:CAST5 4:Blowfish 7:AES128 8:AES192 9:AES256 10:Twofish 11:Camellia128 12:Camellia192 13:Camellia256]) is 9 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
letmein          (?)
1g 0:00:00:38 DONE (2021-01-28 20:09) 0.02581g/s 13.21p/s 13.21c/s 13.21C/s fuckyou1..letmein
Use the "--show" option to display all of the cracked passwords reliably
Session completed
```
